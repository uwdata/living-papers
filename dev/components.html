<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Component Tests</title>
    <script src="../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../node_modules/lit/polyfill-support.js"></script>
    <script type="module">
      import { ObservableCell } from '../src/components/observable-cell.js';
      import { TexMath } from '../src/components/tex-math.js';
      import { TexEquation } from '../src/components/tex-equation.js';
      import { RangeText } from '../src/components/range-text.js';
      import { CodeBlock } from '../src/components/code-block.js';
      import { UnsafeRuntime } from "../src/runtime/runtime-unsafe.js";
      window.customElements.define('obs-cell', ObservableCell);
      window.customElements.define('tex-math', TexMath);
      window.customElements.define('tex-equation', TexEquation);
      window.customElements.define('range-text', RangeText);
      window.customElements.define('code-block', CodeBlock);
      window.runtime = UnsafeRuntime.instance();
    </script>
    <style>
      body { max-width: 800px; }
    </style>
  </head>
  <body>
    <h2>Observable Cells</h2>
    <div>
      <obs-cell code="viewof z = Inputs.range([0, 255], {step:1})"></obs-cell>
      <obs-cell code="html`z<sup>2</sup> = ${z*z}`"></obs-cell><br/>
      z<sup>3</sup> = <obs-cell><script type="ojs">z*z*z</script></obs-cell>
    </div>

    <hr/><h2>Math and Equation Components</h2>
    <div>
      <tex-math mode="display" code="\frac{1}{N} \sum_{i=1}^N x_i^2"></tex-math>
      <tex-equation code="f(x) &= (x+a)(x+b) \nonumber \\ &= x^2 + (a+b)x + ab"></tex-equation>
    </div>

    <hr/><h2>Code Block</h2>
    <div>
      <code-block language="javascript">
let x = 1;
++x
      </code-block>
    </div>

    <hr/><h2>Multi-Way Binding</h2>
    <div>
      Variable: <obs-cell code="v = 0"></obs-cell><br/>
      Drag me: <range-text id="dt" value="20"></range-text><br/>
      Or me: <range-text id="ot" value="25"></range-text><br/>
      <obs-cell id="r0" code="viewof r0 = Inputs.range([-1000, 1000], {step:1, value:-5})"></obs-cell>
      <obs-cell id="r1" code="viewof r1 = Inputs.range([-1000, 1000], {step:1, value:10})"></obs-cell>
      Range Value Observers: [<obs-cell code="r0"></obs-cell>, <obs-cell code="r1"></obs-cell>]
      <script type="module">
        import { binding } from '../src/build/binding.js';
        (await binding(runtime, 'v'))
          .addCell(document.querySelector('#r0'))
          .addCell(document.querySelector('#r1'))
          .add(document.querySelector('#dt'))
          .add(document.querySelector('#ot'));
      </script>
    </div>

    <div>
      Variable: <obs-cell code="s = 'a'"></obs-cell><br/>
      <obs-cell id="s0" code="viewof s0 = Inputs.select(['a', 'b', 'c'])"></obs-cell>
      <obs-cell id="s1" code="viewof s1 = Inputs.select(['a', 'b', 'c'])"></obs-cell>
      Select Value Observers: [<obs-cell code="s0"></obs-cell>, <obs-cell code="s1"></obs-cell>]
      <script type="module">
        import { binding } from '../src/build/binding.js';
        (await binding(runtime, 's'))
          .addCell(document.querySelector('#s0'))
          .addCell(document.querySelector('#s1'));
      </script>
    </div>

    <hr/><h2>Assignment Handlers</h2>
    <div>
      <button id="b0">Assign Values</button>
      <button id="b1">Reset Range</button>
      <button id="b2">Reset Select</button><br/>
      <script type="module">
        const b0 = document.querySelector('#b0');
        const b1 = document.querySelector('#b1');
        const b2 = document.querySelector('#b2');
        b0.addEventListener('click', runtime.handlerUnsafe('(v = 100, s = "c")'));
        b1.addEventListener('click', runtime.handlerUnsafe('v = 0'));
        b2.addEventListener('click', runtime.handlerUnsafe('s = "a"'));
      </script>
    </div>
  </body>
</html>
